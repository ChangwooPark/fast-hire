# 🔗 외래 키(Foreign Key)와 CASCADE 옵션 이해하기

데이터베이스에서 테이블 간의 관계를 맺을 때, 데이터의 일관성을 유지하기 위해 **외래 키 제약 조건**을 사용합니다.

### 1. 구문 분석
`CONSTRAINT fk_post_owner FOREIGN KEY (owner_id) REFERENCES USERS(id) ON DELETE CASCADE`

* **CONSTRAINT [이름]:** 제약 조건에 이름을 부여 (관리 목적).
* **FOREIGN KEY [컬럼]:** 현재 테이블에서 외래 키로 쓸 컬럼 지정.
* **REFERENCES [부모테이블]([컬럼]):** 참조할 대상 테이블과 PK(기본 키) 지정.
* **ON DELETE CASCADE:** 부모 데이터 삭제 시 자식 데이터도 함께 삭제.

---

### 2. 왜 사용하는가? (데이터 무결성)
외래 키 제약 조건을 걸지 않으면, 유저는 탈퇴했는데 그 유저가 쓴 게시물은 그대로 남아있는 **'고아 데이터(Orphan Data)'**가 발생합니다. 이는 DB 용량을 낭비하고 시스템 오류의 원인이 됩니다.



---

### 3. ON DELETE 옵션의 종류
상황에 따라 `CASCADE` 외에도 다른 옵션을 선택할 수 있습니다.

| 옵션 | 설명 | 비유 |
| :--- | :--- | :--- |
| **CASCADE** | 부모 삭제 시 자식도 함께 삭제 | "동반 삭제" |
| **SET NULL** | 부모 삭제 시 자식의 해당 컬럼을 NULL로 변경 | "작성자 알 수 없음 처리" |
| **RESTRICT** | 자식이 남아있으면 부모 삭제를 금지 (기본값) | "글부터 다 지워야 탈퇴 가능" |
| **NO ACTION** | RESTRICT와 유사하게 아무 작업도 하지 않음 | "오류 발생" |

---

### 4. 💡 설계 시 주의사항
* **과도한 CASCADE 주의:** 아주 중요한 데이터(예: 결제 내역)는 유저가 탈퇴하더라도 법적 증거를 위해 남겨둬야 할 수 있습니다. 이럴 때는 `CASCADE` 대신 `SET NULL`을 쓰거나, 아예 삭제하지 않고 `is_active` 상태값만 바꾸는 **소프트 델리트(Soft Delete)** 방식을 고민해야 합니다.