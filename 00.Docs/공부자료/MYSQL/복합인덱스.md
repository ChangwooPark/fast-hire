# π“ λ°μ΄ν„°λ² μ΄μ¤ λ³µν•© μΈλ±μ¤(Composite Index) μƒμ„Έ κ°€μ΄λ“

λ°μ΄ν„°λ² μ΄μ¤μ—μ„ **λ³µν•© μΈλ±μ¤(Composite Index)**λ” λ‘ κ° μ΄μƒμ μ»¬λΌμ„ ν•©μ³μ„ μƒμ„±ν•λ” μΈλ±μ¤λ¥Ό μλ―Έν•©λ‹λ‹¤. νΉμ • μΏΌλ¦¬ ν¨ν„΄μ— μµμ ν™”ν•μ—¬ κ²€μƒ‰ λ° μ •λ ¬ μ†λ„λ¥Ό λΉ„μ•½μ μΌλ΅ ν–¥μƒμ‹ν‚¬ μ μμµλ‹λ‹¤.

---

## 1. ν•µμ‹¬ κµ¬μ΅°: "κ³„μΈµμ  μ •λ ¬"

λ³µν•© μΈλ±μ¤λ¥Ό μ΄ν•΄ν•λ” κ°€μ¥ μΆ‹μ€ λΉ„μ λ” **'μ „ν™”λ²νΈλ¶€'**μ…λ‹λ‹¤. μ „ν™”λ²νΈλ¶€λ” λ³΄ν†µ **[μ„±(Last Name), μ΄λ¦„(First Name)]** μμ„λ΅ μΈλ±μ¤κ°€ κ±Έλ ¤ μμµλ‹λ‹¤.

* **1μ°¨ μ •λ ¬:** 'μ„±'μ„ κΈ°μ¤€μΌλ΅ κ°€λ‚λ‹¤μ μ •λ ¬λ©λ‹λ‹¤.
* **2μ°¨ μ •λ ¬:** κ°™μ€ 'μ„±'μ„ κ°€μ§„ μ‚¬λλ“¤ μ•μ—μ„λ§ 'μ΄λ¦„'μμΌλ΅ λ‹¤μ‹ μ •λ ¬λ©λ‹λ‹¤.

> **ν•µμ‹¬ ν¬μΈνΈ:** 'μ΄λ¦„'μ€ 'μ„±'μ΄ κ°™μ„ λ•λ§ μ •λ ¬μ μλ―Έκ°€ μμµλ‹λ‹¤. 'μ„±'μ„ κ±΄λ„λ›°κ³  'μ΄λ¦„'μΌλ΅λ§ μ°ΎμΌλ ¤κ³  ν•λ©΄ μΈλ±μ¤λ¥Ό μ λ€λ΅ ν™μ©ν•  μ μ—†μµλ‹λ‹¤.

---

## 2. μ»¬λΌ μμ„μ μ¤‘μ”μ„± (Index Skip Scan)

λ³µν•© μΈλ±μ¤ `(room_id, created_at)`λ¥Ό μƒμ„±ν–μ„ λ•, μΈλ±μ¤μ ν¨μ©μ„±μ€ μΏΌλ¦¬ μ΅°κ±΄μ— λ”°λΌ λ‹¬λΌμ§‘λ‹λ‹¤.

* **β… μΈλ±μ¤λ¥Ό νƒ€λ” κ²½μ° (ν¨μ¨μ ):**
    * `WHERE room_id = 10` (μ„ ν–‰ μ»¬λΌλ§ μ‚¬μ©)
    * `WHERE room_id = 10 AND created_at > '2026-01-01'` (μ„ ν–‰ + ν›„ν–‰ μ»¬λΌ μ‚¬μ©)
* **β μΈλ±μ¤λ¥Ό νƒ€μ§€ λ»ν•κ±°λ‚ λΉ„ν¨μ¨μ μΈ κ²½μ°:**
    * `WHERE created_at > '2026-01-01'` (ν›„ν–‰ μ»¬λΌμΌλ΅λ§ μ΅°ν)
    * μ΄λ” μ „ν™”λ²νΈλ¶€μ—μ„ 'μ„±'μ€ λ¬΄μ‹ν•κ³  'μ΄λ¦„μ΄ κΈΈλ™μΈ μ‚¬λ'μ„ μ°Ύλ” κ²ƒκ³Ό κ°™μ•„ μ „μ²΄ λ°μ΄ν„°λ¥Ό λ’¤μ Έμ•Ό ν•©λ‹λ‹¤.

---

## 3. μ •λ ¬(Order By)κ³Ό λ³µν•© μΈλ±μ¤

λ³µν•© μΈλ±μ¤λ” κ²€μƒ‰λΏλ§ μ•„λ‹λΌ **μ •λ ¬ μ‘μ—…μ μƒλµ**μ— κ°•λ ¥ν• κ°•μ μ΄ μμµλ‹λ‹¤.

* **μΈλ±μ¤κ°€ μ—†μ„ λ•:** DBλ” λ°μ΄ν„°λ¥Ό λ¨Όμ € ν•„ν„°λ§ν• ν›„, λ©”λ¨λ¦¬ κ³µκ°„μ—μ„ `ORDER BY created_at DESC` μ‘μ—…μ„ μν–‰ν•©λ‹λ‹¤ (**Filesort** λ°μƒ).
* **λ³µν•© μΈλ±μ¤ `(room_id, created_at DESC)`κ°€ μμ„ λ•:**
    * μ΄λ―Έ λ””μ¤ν¬ μƒμ— `room_id`λ³„λ΅ λ©”μ‹μ§€κ°€ μ‹κ°„ μ—­μμΌλ΅ μ •λ ¬λμ–΄ μ“μ—¬ μμµλ‹λ‹¤.
    * DBλ” λ³„λ„μ μ •λ ¬ μ—°μ‚° μ—†μ΄ μ €μ¥λ μμ„λ€λ΅ μ½κΈ°λ§ ν•λ©΄ λ©λ‹λ‹¤.

---

## 4. λ³µν•© μΈλ±μ¤ μ„¤κ³„ κ³µμ‹ (Rule of Thumb)

ν¨μ¨μ μΈ μΈλ±μ¤ μ„¤κ³„λ¥Ό μ„ν•΄ μ•„λ μμ„λ¥Ό κ³ λ ¤ν•©λ‹λ‹¤.

1.  **Equal(=) μ΅°κ±΄**μΌλ΅ μμ£Ό μ“°μ΄λ” μ»¬λΌμ„ μ•μ— λ‘”λ‹¤ (`room_id = ?`).
2.  **λ²”μ„(<, >, BETWEEN)** μ΅°κ±΄μΌλ΅ μ“°μ΄λ” μ»¬λΌμ€ λ’¤μ— λ‘”λ‹¤ (`created_at > ?`).
3.  **μ΅°νμ™€ μ •λ ¬**μ΄ ν• λ²μ— μΌμ–΄λ‚λ” μ»¬λΌ μ„ΈνΈλ¥Ό κ·Έλ£Ήν™”ν•λ‹¤.

---

## 5. λ‹¨μ  λ° λΉ„μ© (Trade-off)

* **μ“°κΈ° μ„±λ¥ μ €ν•:** λ°μ΄ν„° μ‚½μ…(`INSERT`) μ‹λ§λ‹¤ μΈλ±μ¤ μ§€λ„λ¥Ό μƒλ΅ κ·Έλ ¤μ•Ό ν•λ―€λ΅ μ¤λ²„ν—¤λ“κ°€ λ°μƒν•©λ‹λ‹¤.
* **μ €μ¥ κ³µκ°„:** μΈλ±μ¤ νμΌ μμ²΄κ°€ λ³„λ„μ λ¬Όλ¦¬μ  κ³µκ°„μ„ μ°¨μ§€ν•©λ‹λ‹¤.
* **κ΄€λ¦¬ λ³µμ΅λ„:** λ„λ¬΄ λ§μ€ μΈλ±μ¤λ” μµν‹°λ§μ΄μ €κ°€ μ—‰λ±ν• μ‹¤ν–‰ κ³„νμ„ μ„Έμ°κ² ν•  μ μμµλ‹λ‹¤.

---

## π“ μ”μ•½ μ •λ¦¬

| ν•­λ© | λ‚΄μ© |
| :--- | :--- |
| **μ •μ** | λ‘ κ° μ΄μƒμ μ»¬λΌμ„ κ²°ν•©ν•μ—¬ μƒμ„±ν•λ” μΈλ±μ¤ |
| **μ›λ¦¬** | μ„ ν–‰ μ»¬λΌμΌλ΅ μ •λ ¬ ν›„, λ™μΌ κ°’ λ‚΄μ—μ„ ν›„ν–‰ μ»¬λΌμΌλ΅ μ •λ ¬ |
| **μ¥μ ** | νΉμ • μ΅°κ±΄ ν•„ν„°λ§ + μ •λ ¬ μµμ ν™” (Filesort λ°©μ§€) |
| **μ£Όμ** | **μ»¬λΌμ μμ„**κ°€ κ²€μƒ‰ ν¨μ¨μ ν•µμ‹¬ (μ²« λ²μ§Έ μ»¬λΌ λ„λ½ μ‹ μΈλ±μ¤ λ―Έμ‘λ™) |
| **μ±„ν… μμ‹** | `(room_id, created_at)` -> νΉμ • λ°©μ λ©”μ‹μ§€λ¥Ό μµμ‹ μμΌλ΅ μ¦‰μ‹ μ΅°ν |